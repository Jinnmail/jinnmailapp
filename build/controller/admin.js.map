{"version":3,"sources":["../../src/controller/admin.js"],"names":["AdminController","data","Promise","resolve","reject","adminModel","findOne","then","adminData","code","msg","username","bcrypt","compare","password","err","res","console","log","payload","subject","token","jwt","sign","process","env","JWT_SECRET","undefined","User","aggregate","$match","uid","$lookup","$sort","result","catch","Alias","aid","$unwind","key","value"],"mappings":"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","file":"admin.js","sourcesContent":["import adminModel from '../models/admin'\r\nimport Alias from '../models/alias'\r\nimport User from '../models/user'\r\nimport bcrypt from 'bcrypt-nodejs'\r\nimport uuidv4 from 'uuid-v4'\r\nimport jwt from 'jsonwebtoken'\r\nimport request from \"request\"\r\n\r\nclass AdminController{\r\n    getAdmin(data){\r\n        // console.log(\"JWT:\"+process.env.JWT_SECRET)\r\n        return new Promise((resolve, reject) => {\r\n            adminModel.findOne({}).then((adminData) => {\r\n                if(!adminData)\r\n                {\r\n                    reject({ code: 500 , msg: 'err'})\r\n                }\r\n                else\r\n                {\r\n                    // console.log(data.username+\"***\"+data.password)\r\n                    // console.log(adminData.username+\"---\"+adminData.password)\r\n                    if(data.username === adminData.username)\r\n                    {\r\n                        bcrypt.compare(data.password, adminData.password, function(err, res) {\r\n                            console.log(\"Password: \"+res)\r\n                            if(res)\r\n                            {\r\n                                let payload = { subject: adminData.username }\r\n                                let token = jwt.sign(payload, process.env.JWT_SECRET)\r\n                                resolve({token})\r\n                            }\r\n                            else\r\n                                resolve(undefined);\r\n                        });\r\n                    }else\r\n                    {\r\n                        resolve(undefined);\r\n                    }\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    getUser(data)\r\n    {\r\n        return new Promise((resolve, reject) => {\r\n            // console.log(data.uid)\r\n            User.aggregate([\r\n                {\r\n                    $match: {\r\n                        \"userId\": data.uid\r\n                    }\r\n                },\r\n                { \r\n                    $lookup: {\r\n                        \"from\": \"aliases\",\r\n                        \"localField\": \"userId\",\r\n                        \"foreignField\": \"userId\",\r\n                        \"as\": \"aliases\"\r\n                    }\r\n                },\r\n                {\r\n                    $sort:{\r\n                        // \"created\":-1,\r\n                        \"aliases.created\":-1\r\n                    }\r\n                }\r\n            ]).then(result => {\r\n                // console.log(\"Result is: \"+ (result)?JSON.stringify(result):\"0\");  \r\n                // console.log(JSON.stringify(result[0].aliases))\r\n                resolve(result);\r\n                // console.log(val[0].user[0].email);\r\n            }).catch((err) => {\r\n                reject({ code: 500, msg: err });\r\n            });\r\n        })\r\n    }\r\n\r\n    getAlias(data)\r\n    {\r\n        return new Promise((resolve, reject) => {\r\n            Alias.aggregate([\r\n                {\r\n                    $match: {\r\n                        \"aliasId\": data.aid\r\n                    }\r\n                },\r\n                { \r\n                    $lookup: {\r\n                        \"from\": \"users\",\r\n                        \"localField\": \"userId\",\r\n                        \"foreignField\": \"userId\",\r\n                        \"as\": \"user\"\r\n                    }\r\n                },\r\n                {\r\n                    $unwind: \"$user\"\r\n                }\r\n            ]).then(result => {\r\n                // console.log(\"Result is: \"+ (result)?JSON.stringify(result):\"0\");  \r\n                // console.log(JSON.stringify(result[0].aliases))\r\n                resolve(result);\r\n                // console.log(val[0].user[0].email);\r\n            }).catch((err) => {\r\n                reject({ code: 500, msg: err });\r\n            });\r\n        })\r\n    }\r\n\r\n    getSearched(data)\r\n    {\r\n        return new Promise((resolve, reject) => {\r\n            if(data.key === \"aliasId\")\r\n            {\r\n                Alias.aggregate([\r\n                    {\r\n                        $match: {\r\n                            \"aliasId\": data.value\r\n                        }\r\n                    },\r\n                    { \r\n                        $lookup: {\r\n                            \"from\": \"users\",\r\n                            \"localField\": \"userId\",\r\n                            \"foreignField\": \"userId\",\r\n                            \"as\": \"user\"\r\n                        }\r\n                    },\r\n                    {\r\n                        $unwind: \"$user\"\r\n                    }\r\n                ]).then(result => {\r\n                    // console.log(\"Result is: \"+ (result)?JSON.stringify(result):\"0\");  \r\n                    // console.log(JSON.stringify(result[0].aliases))\r\n                    resolve(result);\r\n                    // console.log(val[0].user[0].email);\r\n                }).catch((err) => {\r\n                    reject({ code: 500, msg: err });\r\n                });\r\n            }\r\n            else if(data.key === \"alias\")\r\n            {\r\n                Alias.aggregate([\r\n                    {\r\n                        $match: {\r\n                            \"alias\": data.value\r\n                        }\r\n                    },\r\n                    { \r\n                        $lookup: {\r\n                            \"from\": \"users\",\r\n                            \"localField\": \"userId\",\r\n                            \"foreignField\": \"userId\",\r\n                            \"as\": \"user\"\r\n                        }\r\n                    },\r\n                    {\r\n                        $unwind: \"$user\"\r\n                    }\r\n                ]).then(result => {\r\n                    // console.log(\"Result is: \"+ (result)?JSON.stringify(result):\"0\");  \r\n                    // console.log(JSON.stringify(result[0].aliases))\r\n                    resolve(result);\r\n                    // console.log(val[0].user[0].email);\r\n                }).catch((err) => {\r\n                    reject({ code: 500, msg: err });\r\n                });\r\n            }\r\n            else if(data.key === \"email\")\r\n            {\r\n                User.aggregate([\r\n                    {\r\n                        $match: {\r\n                            \"email\": data.value\r\n                        }\r\n                    },\r\n                    { \r\n                        $lookup: {\r\n                            \"from\": \"aliases\",\r\n                            \"localField\": \"userId\",\r\n                            \"foreignField\": \"userId\",\r\n                            \"as\": \"aliases\"\r\n                        }\r\n                    },\r\n                    {\r\n                        $sort:{\r\n                            // \"created\":-1,\r\n                            \"aliases.created\":-1\r\n                        }\r\n                    }\r\n                ]).then(result => {\r\n                    // console.log(\"Result is: \"+ (result)?JSON.stringify(result):\"0\");  \r\n                    // console.log(JSON.stringify(result[0].aliases))\r\n                    resolve(result);\r\n                    // console.log(val[0].user[0].email);\r\n                }).catch((err) => {\r\n                    reject({ code: 500, msg: err });\r\n                });\r\n            }\r\n            else\r\n            {\r\n                User.aggregate([\r\n                    {\r\n                        $match: {\r\n                            \"userId\": data.value\r\n                        }\r\n                    },\r\n                    { \r\n                        $lookup: {\r\n                            \"from\": \"aliases\",\r\n                            \"localField\": \"userId\",\r\n                            \"foreignField\": \"userId\",\r\n                            \"as\": \"aliases\"\r\n                        }\r\n                    },\r\n                    {\r\n                        $sort:{\r\n                            // \"created\":-1,\r\n                            \"aliases.created\":-1\r\n                        }\r\n                    }\r\n                ]).then(result => {\r\n                    // console.log(\"Result is: \"+ (result)?JSON.stringify(result):\"0\");  \r\n                    // console.log(JSON.stringify(result[0].aliases))\r\n                    resolve(result);\r\n                    // console.log(val[0].user[0].email);\r\n                }).catch((err) => {\r\n                    reject({ code: 500, msg: err });\r\n                });\r\n            }\r\n            // resolve(data)\r\n        }) \r\n    }\r\n}\r\nexport default new AdminController(); "]}