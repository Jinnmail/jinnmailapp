{"version":3,"sources":["../../src/models/user.js"],"names":["SALT_WORK_FACTOR","userSchema","mongoose","Schema","userId","type","String","required","email","unique","lowercase","password","validate","v","length","verificationCode","verified","Boolean","default","resetPasswordToken","resetPasswordExpires","Date","created","now","aliasesCount","Number","pre","next","user","isModified","bcrypt","genSalt","err","salt","hash","model"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;AAEA,IAAIA,mBAAmB,EAAvB;;AAEA,IAAMC,aAAaC,aAASC,MAAT,CAAgB;AAC/BC,YAAQ;AACJC,cAAMC,MADF;AAEJC,kBAAU;AAFN,KADuB;AAK/BC,WAAO;AACHH,cAAMC,MADH;AAEHG,gBAAQ,IAFL;AAGHC,mBAAW,IAHR;AAIHH,kBAAW,CAAC,IAAD,EAAO,yBAAP;AAJR,KALwB;AAW/BI,cAAU;AACNN,cAAMC,MADA;AAENC,kBAAU,CAAC,IAAD,EAAO,4BAAP,CAFJ;AAGNK,kBAAU,CAAC,UAAUC,CAAV,EAAa;AACpB,mBAAOA,EAAEC,MAAF,IAAY,CAAnB;AACH,SAFS,EAEP,gCAFO;AAHJ,KAXqB;AAkB/BC,sBAAkB;AACdV,cAAMC;;AADQ,KAlBa;AAsB/BU,cAAW;AACPX,cAAMY,OADC;AAEPC,iBAAQ;AAFD,KAtBoB;AA0B/BC,wBAAmB;AACfd,cAAMC,MADS;AAEfY,iBAAQ;AAFO,KA1BY;AA8B/BE,0BAAqB;AACjBf,cAAMgB;AADW,KA9BU;AAiC/BC,aAAS;AACLjB,cAAMgB,IADD;AAELH,iBAASG,KAAKE;AAFT,KAjCsB;AAqC/BC,kBAAc;AACVnB,cAAMoB,MADI;AAEVP,iBAAS;AAFC;AArCiB,CAAhB,CAAnB;AA0CA;;;;AAIAjB,WAAWyB,GAAX,CAAe,MAAf,EAAuB,UAAUC,IAAV,EAAgB;AACnC,QAAMC,OAAO,IAAb;AACA,QAAI,CAACA,KAAKC,UAAL,CAAgB,UAAhB,CAAL,EACI,OAAOF,MAAP;;AAEJG,2BAAOC,OAAP,CAAe/B,gBAAf,EAAiC,UAACgC,GAAD,EAAMC,IAAN,EAAe;AAC5C,YAAID,GAAJ,EACI,OAAOL,KAAKK,GAAL,CAAP;AACJF,+BAAOI,IAAP,CAAYN,KAAKjB,QAAjB,EAA2BsB,IAA3B,EAAiC,IAAjC,EAAuC,UAACD,GAAD,EAAME,IAAN,EAAe;AAClD,gBAAIF,GAAJ,EACI,OAAOL,KAAKK,GAAL,CAAP;;AAEJJ,iBAAKjB,QAAL,GAAgBuB,IAAhB;AACAP;AACH,SAND;AAOH,KAVD;AAWH,CAhBD;;AAkBA,IAAMC,OAAO1B,aAASiC,KAAT,CAAe,MAAf,EAAuBlC,UAAvB,CAAb;;kBAEe2B,I","file":"user.js","sourcesContent":["import mongoose from '../db/db'\r\nimport bcrypt from 'bcrypt-nodejs';\r\n\r\nlet SALT_WORK_FACTOR = 10;\r\n\r\nconst userSchema = mongoose.Schema({\r\n    userId: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    email: {\r\n        type: String,\r\n        unique: true,\r\n        lowercase: true,\r\n        required:  [true, 'email field is Required']\r\n    },\r\n    password: {\r\n        type: String,\r\n        required: [true, 'password field is Required'],\r\n        validate: [function (v) {\r\n            return v.length >= 8;\r\n        }, 'Password min length is 8 chars']\r\n    },\r\n    verificationCode: {\r\n        type: String\r\n        \r\n    },\r\n    verified : {\r\n        type: Boolean,\r\n        default:false\r\n    },\r\n    resetPasswordToken:{\r\n        type: String,\r\n        default:null\r\n    },\r\n    resetPasswordExpires:{\r\n        type: Date\r\n    },\r\n    created: {\r\n        type: Date,\r\n        default: Date.now\r\n    },\r\n    aliasesCount: {\r\n        type: Number,\r\n        default: 0\r\n    }\r\n});\r\n/*\r\n * Encrypt the password before saving it to DB\r\n */\r\n\r\nuserSchema.pre('save', function (next) {\r\n    const user = this;\r\n    if (!user.isModified('password'))\r\n        return next();\r\n\r\n    bcrypt.genSalt(SALT_WORK_FACTOR, (err, salt) => {\r\n        if (err)\r\n            return next(err);\r\n        bcrypt.hash(user.password, salt, null, (err, hash) => {\r\n            if (err)\r\n                return next(err);\r\n\r\n            user.password = hash;\r\n            next();\r\n        });\r\n    });\r\n});\r\n\r\nconst user = mongoose.model('user', userSchema);\r\n\r\nexport default user;\r\n\r\n"]}